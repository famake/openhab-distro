var time2 = 0

rule "timer 10s"
when
    Time cron "*/10 * * * * ?"
then
    if (timerActive.state == ON) {
        time2 = Math.max(0, (timeLeft.state as Number).intValue()) - 10
        if (time2 <= 0) {
            postUpdate(timeLeft, fatimer.state)
            postUpdate(timerActive, OFF)
            // Alarm
            sendCommand(artnet_node_fbf96f11_color, ON)
            Thread.sleep(200)
            sendCommand(artnet_node_fbf96f11_color, OFF)
            Thread.sleep(200)
            sendCommand(artnet_node_fbf96f11_color, ON)
            Thread.sleep(200)
            sendCommand(artnet_node_fbf96f11_color, OFF)
            Thread.sleep(200)
            sendCommand(artnet_node_fbf96f11_color, ON)
            Thread.sleep(200)
            sendCommand(artnet_node_fbf96f11_color, OFF)
            Thread.sleep(200)
            sendCommand(artnet_node_fbf96f11_color, ON)
            Thread.sleep(200)
            sendCommand(artnet_node_fbf96f11_color, OFF)
            Thread.sleep(200)
            sendCommand(artnet_node_fbf96f11_color, ON)
        }
        postUpdate(timeLeft, time2)
    }
end

rule "Endre alarm"
when 
    Item fatimer changed
then
    if (timerActive.state != ON) {
        postUpdate(timeLeft, fatimer.state)
    }
end


rule "default"
when 
    System started
then
    postUpdate(fatimer, 600)
end
